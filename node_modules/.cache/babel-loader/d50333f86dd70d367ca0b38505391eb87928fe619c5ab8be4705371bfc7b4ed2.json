{"ast":null,"code":"import _slicedToArray from\"/Users/HenryTsui/Desktop/rizzy-bodycraft-record/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import{useCallback,useEffect,useState}from\"react\";import{DropdownMenu}from\"../../../components/DropdownMenu/DropdownMenu\";import{Title}from\"../../../components/Title/Title\";import Firebase from\"../../../firebase\";import\"./Categories.css\";import{AddInputPanel}from\"../../../components/AddPanel/AddInputPanel\";import{AddChoicePanel}from\"../../../components/AddPanel/AddChoicePanel\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";export var Categories=function Categories(){var _categories$find;var _useState=useState([]),_useState2=_slicedToArray(_useState,2),categories=_useState2[0],setCategories=_useState2[1];var _useState3=useState(),_useState4=_slicedToArray(_useState3,2),categoryId=_useState4[0],setCategoryId=_useState4[1];var _useState5=useState(),_useState6=_slicedToArray(_useState5,2),activeDropdown=_useState6[0],setActiveDropdown=_useState6[1];var _useState7=useState([]),_useState8=_slicedToArray(_useState7,2),options=_useState8[0],setOptions=_useState8[1];var _useState9=useState(),_useState10=_slicedToArray(_useState9,2),addModal=_useState10[0],setAddModal=_useState10[1];useEffect(function(){var closeDropdown=function closeDropdown(){console.log(\"close dropdown\");setActiveDropdown(undefined);};window.addEventListener(\"click\",closeDropdown);return function(){return window.removeEventListener(\"click\",closeDropdown);};},[]);useEffect(function(){Firebase.instance.getCategories().then(function(categories){return setCategories(categories.map(function(category){return{label:category.title,id:category.id};}));});},[]);// useEffect(() => {\n//     if (categoryId) Firebase.instance.getOptions(categoryId).then(options => setOptions(options));\n// }, [categoryId]);\nuseEffect(function(){if(categoryId)Firebase.instance.onOptionUpdate(categoryId,function(options){return setOptions(options);});},[categoryId]);var onInput=useCallback(function(set,e){set(e.currentTarget.value);},[]);var optionRow=useCallback(function(details){return/*#__PURE__*/_jsxs(\"div\",{className:\"option\",children:[/*#__PURE__*/_jsx(\"button\",{className:\"delete\",onClick:function onClick(){return Firebase.instance.deleteOption(categoryId,details.id);}}),/*#__PURE__*/_jsx(\"input\",{value:details.title,onChange:function onChange(){}}),details.choices?/*#__PURE__*/_jsx(DropdownMenu,{onSelect:function onSelect(_id,e){return e.stopPropagation();},opened:activeDropdown===details.id,onOpen:function onOpen(){return setActiveDropdown(details.id);},onClose:function onClose(){return setActiveDropdown(undefined);},default:\"顯示所有選項\",current:\"\",choices:details.choices.map(function(choice){return{id:details.id,label:choice,allowRemove:true};})}):/*#__PURE__*/_jsx(\"div\",{children:\"\\u8F38\\u5165\"})]},details.id);},[options,activeDropdown]);return/*#__PURE__*/_jsxs(\"main\",{id:\"categories\",children:[/*#__PURE__*/_jsx(Title,{}),/*#__PURE__*/_jsxs(\"section\",{id:\"content\",children:[/*#__PURE__*/_jsx(\"div\",{id:\"dropdown_big\",children:/*#__PURE__*/_jsx(DropdownMenu,{onSelect:setCategoryId,opened:activeDropdown===\"category\",onOpen:function onOpen(){return setActiveDropdown(\"category\");},onClose:function onClose(){return setActiveDropdown(undefined);},default:\"選擇分類\",current:(_categories$find=categories.find(function(cat){return cat.id===categoryId;}))===null||_categories$find===void 0?void 0:_categories$find.label,choices:categories})}),options.map(function(option){return optionRow(option);}),categoryId&&/*#__PURE__*/_jsx(\"button\",{className:\"add\",onClick:function onClick(){return setAddModal(/*#__PURE__*/_jsx(AddChoicePanel,{categoryId:categoryId,close:function close(){return setAddModal(undefined);}}));},children:\"\\u65B0\\u589E\\u9078\\u9805 \\uFF0B\"}),categoryId&&/*#__PURE__*/_jsx(\"button\",{className:\"add\",onClick:function onClick(){return setAddModal(/*#__PURE__*/_jsx(AddInputPanel,{categoryId:categoryId,close:function close(){return setAddModal(undefined);}}));},children:\"\\u65B0\\u589E\\u8F38\\u5165 \\uFF0B\"})]}),addModal&&addModal]});};","map":{"version":3,"names":["useCallback","useEffect","useState","DropdownMenu","Title","Firebase","AddInputPanel","AddChoicePanel","Categories","categories","setCategories","categoryId","setCategoryId","activeDropdown","setActiveDropdown","options","setOptions","addModal","setAddModal","closeDropdown","console","log","undefined","window","addEventListener","removeEventListener","instance","getCategories","then","map","category","label","title","id","onOptionUpdate","onInput","set","e","currentTarget","value","optionRow","details","deleteOption","choices","_id","stopPropagation","choice","allowRemove","find","cat","option"],"sources":["/Users/HenryTsui/Desktop/rizzy-bodycraft-record/src/pages/Admin/Categories/Categories.tsx"],"sourcesContent":["import { useCallback, useEffect, useState } from \"react\";\nimport { DropdownMenu } from \"../../../components/DropdownMenu/DropdownMenu\";\nimport { Title } from \"../../../components/Title/Title\";\nimport Firebase from \"../../../firebase\";\nimport \"./Categories.css\";\nimport { Option } from \"../../../type\";\nimport { AddInputPanel } from \"../../../components/AddPanel/AddInputPanel\";\nimport { AddChoicePanel } from \"../../../components/AddPanel/AddChoicePanel\";\nexport const Categories = () => {\n\n    const [categories, setCategories] = useState<Array<{ label: string, id: string }>>([]);\n    const [categoryId, setCategoryId] = useState<string>();\n    const [activeDropdown, setActiveDropdown] = useState<string>();\n    const [options, setOptions] = useState<Array<Option>>([]);\n    const [addModal, setAddModal] = useState<JSX.Element>();\n\n    useEffect(() => {\n        let closeDropdown = () => {\n            console.log(\"close dropdown\");\n            setActiveDropdown(undefined)\n        };\n        window.addEventListener(\"click\", closeDropdown);\n\n        return () => window.removeEventListener(\"click\", closeDropdown);\n    }, [])\n\n    useEffect(() => {\n        Firebase.instance.getCategories().then(categories =>\n            setCategories(categories.map(category => {\n                return { label: category.title, id: category.id }\n            }))\n        );\n    }, [])\n\n    // useEffect(() => {\n    //     if (categoryId) Firebase.instance.getOptions(categoryId).then(options => setOptions(options));\n    // }, [categoryId]);\n\n    useEffect(() => {\n        if (categoryId) Firebase.instance.onOptionUpdate(categoryId, (options) => setOptions(options));\n    }, [categoryId])\n\n    const onInput = useCallback((set: React.Dispatch<string>, e: React.ChangeEvent<HTMLInputElement>) => {\n        set(e.currentTarget.value);\n    }, []);\n\n    const optionRow = useCallback((details: Option) => {\n        return (\n            <div className=\"option\" key={ details.id }>\n                <button className=\"delete\" onClick={ () => Firebase.instance.deleteOption(categoryId!, details.id)}/>\n                <input value={ details.title } onChange={ () => {} } />\n                {   details.choices ?\n                        <DropdownMenu onSelect={ (_id, e) => e.stopPropagation() } opened={ activeDropdown === details.id } onOpen={ () => setActiveDropdown(details.id) } onClose={ () => setActiveDropdown(undefined) } default={ \"顯示所有選項\" } current={ \"\" } choices={ details.choices.map(choice => { return { id: details.id, label: choice, allowRemove: true } }) } /> :\n                        <div>輸入</div>\n                }\n            </div>\n        )\n    }, [options, activeDropdown]);\n\n    return (\n        <main id=\"categories\">\n            <Title />\n            <section id=\"content\">\n                <div id=\"dropdown_big\">\n                    <DropdownMenu onSelect={ setCategoryId } opened={ activeDropdown === \"category\"} onOpen={ () => setActiveDropdown(\"category\") } onClose={ () => setActiveDropdown(undefined) } default={ \"選擇分類\" } current={ categories.find(cat => cat.id === categoryId)?.label } choices={ categories } />\n                </div>\n                { options.map(option => optionRow(option)) }\n                { categoryId && <button className=\"add\" onClick={ () => setAddModal(<AddChoicePanel categoryId={ categoryId } close={ () => setAddModal(undefined) } />) }>新增選項 ＋</button> }\n                { categoryId && <button className=\"add\" onClick={ () => setAddModal(<AddInputPanel categoryId={ categoryId } close={ () => setAddModal(undefined) } />) }>新增輸入 ＋</button> }\n            </section>\n            { addModal && addModal }\n        </main>\n    )\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}