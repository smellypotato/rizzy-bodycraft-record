{"ast":null,"code":"import { initializeApp } from \"firebase/app\";\nimport { getAuth, isSignInWithEmailLink, onAuthStateChanged, sendSignInLinkToEmail, signInWithEmailAndPassword, signInWithEmailLink, signOut, updatePassword } from \"firebase/auth\";\nimport { collection, deleteDoc, doc, getDoc, getDocs, getFirestore, onSnapshot, setDoc } from \"firebase/firestore\";\nimport { optionConverter, categoryConverter } from \"./type\";\nconst firebaseConfig = {\n  apiKey: \"AIzaSyDHTYHXBArEA-6bqGFdbqsG1_KLuzGRE2I\",\n  authDomain: \"rizzy-bodycraft-record.firebaseapp.com\",\n  projectId: \"rizzy-bodycraft-record\",\n  storageBucket: \"rizzy-bodycraft-record.appspot.com\",\n  messagingSenderId: \"930408534506\",\n  appId: \"1:930408534506:web:127e3be9dd6236d9836293\",\n  measurementId: \"G-SKFHESV2J6\"\n};\nvar COLLECTION;\n(function (COLLECTION) {\n  COLLECTION[\"CATEGORY\"] = \"category\";\n  COLLECTION[\"USER_PROFILE\"] = \"user-profile\";\n  COLLECTION[\"APPLICATION\"] = \"application\";\n})(COLLECTION || (COLLECTION = {}));\nexport default class Firebase {\n  constructor() {\n    this.app = void 0;\n    this.auth = void 0;\n    this.firestore = void 0;\n    console.log(\"initializing firebase\");\n    this.app = initializeApp(firebaseConfig);\n    this.auth = getAuth(this.app);\n    this.firestore = getFirestore(this.app);\n  }\n  static get instance() {\n    return Firebase._inst;\n  }\n  static init() {\n    if (!Firebase._inst) Firebase._inst = new Firebase();\n  }\n\n  // auth\n\n  async signup(email, password, name) {\n    updatePassword(this.auth.currentUser, password).then(() => {\n      this.updateUserProfile({\n        email,\n        name\n      });\n    }).catch(err => console.error(err));\n  }\n  async login(args) {\n    const {\n      email,\n      password\n    } = args;\n    if (email !== undefined) {\n      if (password !== undefined) {\n        return await new Promise((resolve, reject) => {\n          signInWithEmailAndPassword(this.auth, email, password).then(credential => {\n            console.log(credential);\n            resolve(true);\n          }).catch(err => {\n            console.error(err.code);\n            reject(false);\n          });\n        });\n      } else {\n        console.log(email);\n        return await new Promise((resolve, reject) => signInWithEmailLink(this.auth, email, window.location.href).then(result => {\n          console.log(result);\n          resolve(true);\n        }).catch(err => {\n          // auth/invalid-email\n          // auth/invalid-action-code when link used to login\n          console.error(err.code, err.message);\n          reject(false);\n        }));\n      }\n    }\n    return false;\n  }\n  async logout() {\n    await signOut(Firebase.instance.auth);\n  }\n  onAuthStateChanged(callback) {\n    return onAuthStateChanged(this.auth, user => callback(user));\n  }\n  approvePendingAccount(email) {\n    const actionCodeSettings = {\n      // URL you want to redirect back to. The domain (www.example.com) for this\n      // URL must be in the authorized domains list in the Firebase Console.\n      url: 'http://localhost:3000',\n      handleCodeInApp: true\n    };\n    sendSignInLinkToEmail(this.auth, email, actionCodeSettings).then(() => console.log(\"success\")).catch(err => console.log(\"failed\", err));\n  }\n  isAnnoymousAccount() {\n    return isSignInWithEmailLink(this.auth, window.location.href);\n  }\n\n  // firestore\n\n  onPendingAccountsChange(callback) {\n    return onSnapshot(collection(this.firestore, COLLECTION.APPLICATION), collection => {\n      let pendings = [];\n      collection.forEach(application => pendings.push(Object.assign({\n        id: application.id\n      }, application.data())));\n      callback(pendings);\n    });\n  }\n  async removePendingAccount(id) {\n    await deleteDoc(doc(this.firestore, COLLECTION.APPLICATION, id));\n  }\n  async checkNewAccount(email) {\n    return !(await getDoc(doc(this.firestore, COLLECTION.USER_PROFILE, email))).exists();\n  }\n  async updateUserProfile(profile) {\n    await setDoc(doc(this.firestore, COLLECTION.USER_PROFILE, profile.email), {\n      name: profile.name,\n      email: profile.email\n    });\n  }\n  async getCategories() {\n    let categories = [];\n    (await getDocs(collection(this.firestore, COLLECTION.CATEGORY).withConverter(categoryConverter))).forEach(cat => {\n      console.log(cat);\n      categories.push(cat);\n    });\n    return categories;\n  }\n  async getOptions(categoryId) {\n    let options = [];\n    await getDocs(collection(this.firestore, COLLECTION.CATEGORY, categoryId, \"Options\").withConverter(optionConverter)).then(opts => opts.forEach(opt => options.push(opt.data())));\n    return options;\n  }\n}\nFirebase._inst = void 0;","map":{"version":3,"names":["initializeApp","getAuth","isSignInWithEmailLink","onAuthStateChanged","sendSignInLinkToEmail","signInWithEmailAndPassword","signInWithEmailLink","signOut","updatePassword","collection","deleteDoc","doc","getDoc","getDocs","getFirestore","onSnapshot","setDoc","optionConverter","categoryConverter","firebaseConfig","apiKey","authDomain","projectId","storageBucket","messagingSenderId","appId","measurementId","COLLECTION","Firebase","constructor","app","auth","firestore","console","log","instance","_inst","init","signup","email","password","name","currentUser","then","updateUserProfile","catch","err","error","login","args","undefined","Promise","resolve","reject","credential","code","window","location","href","result","message","logout","callback","user","approvePendingAccount","actionCodeSettings","url","handleCodeInApp","isAnnoymousAccount","onPendingAccountsChange","APPLICATION","pendings","forEach","application","push","Object","assign","id","data","removePendingAccount","checkNewAccount","USER_PROFILE","exists","profile","getCategories","categories","CATEGORY","withConverter","cat","getOptions","categoryId","options","opts","opt"],"sources":["/Users/HenryTsui/Desktop/rizzy-bodycraft-record/src/firebase.ts"],"sourcesContent":["import { FirebaseApp, initializeApp } from \"firebase/app\";\nimport { Auth, createUserWithEmailAndPassword, getAdditionalUserInfo, getAuth, isSignInWithEmailLink, onAuthStateChanged, sendSignInLinkToEmail, signInWithEmailAndPassword, signInWithEmailLink, signOut, updatePassword, User, UserCredential } from \"firebase/auth\";\nimport { collection, deleteDoc, doc, Firestore, getDoc, getDocs, getFirestore, onSnapshot, query, setDoc, where } from \"firebase/firestore\";\nimport { optionConverter, PendingApplcation, Option, categoryConverter } from \"./type\";\nconst firebaseConfig = {\n  apiKey: \"AIzaSyDHTYHXBArEA-6bqGFdbqsG1_KLuzGRE2I\",\n  authDomain: \"rizzy-bodycraft-record.firebaseapp.com\",\n  projectId: \"rizzy-bodycraft-record\",\n  storageBucket: \"rizzy-bodycraft-record.appspot.com\",\n  messagingSenderId: \"930408534506\",\n  appId: \"1:930408534506:web:127e3be9dd6236d9836293\",\n  measurementId: \"G-SKFHESV2J6\"\n};\n\nenum COLLECTION {\n    CATEGORY = \"category\",\n    USER_PROFILE = \"user-profile\",\n    APPLICATION = \"application\"\n}\n\nexport default class Firebase {\n\n    private static _inst: Firebase;\n\n    app: FirebaseApp;\n    auth: Auth;\n    firestore: Firestore;\n\n    private constructor() {\n        console.log(\"initializing firebase\");\n        this.app = initializeApp(firebaseConfig);\n        this.auth = getAuth(this.app);\n        this.firestore = getFirestore(this.app)\n    }\n\n    public static get instance() {\n        return Firebase._inst;\n    }\n\n    static init() {\n        if (!Firebase._inst) Firebase._inst = new Firebase();\n    }\n\n    // auth\n\n    async signup(email: string, password: string, name: string) {\n        updatePassword(this.auth.currentUser!, password).then(() => {\n            this.updateUserProfile({ email, name });\n        }).catch(err => console.error(err));\n    }\n\n    async login(args: { email: string, password?: string }): Promise<boolean> {\n        const { email, password } = args;\n        if (email !== undefined) {\n            if (password !== undefined) {\n                return await new Promise((resolve, reject) => {\n                    signInWithEmailAndPassword(this.auth, email, password).then(credential => {\n                        console.log(credential);\n                        resolve(true);\n                    }).catch((err: { code: string, message: string } ) => {\n                        console.error(err.code);\n                        reject(false);\n                    });\n                });\n            }\n            else {\n                console.log(email);\n                return await new Promise((resolve, reject) =>\n                    signInWithEmailLink(this.auth, email, window.location.href).then(result => {\n                        console.log(result);\n                        resolve(true);\n                    }).catch((err: { code: string, message: string }) => {\n                        // auth/invalid-email\n                        // auth/invalid-action-code when link used to login\n                        console.error(err.code, err.message);\n                        reject(false)\n                    })\n                );\n            }\n        }\n        return false;\n    }\n\n    async logout() {\n        await signOut(Firebase.instance.auth);\n    }\n\n    onAuthStateChanged(callback: (user: User | null) => void) {\n        return onAuthStateChanged(this.auth, user => callback(user));\n    }\n\n    approvePendingAccount(email: string) {\n        const actionCodeSettings = {\n            // URL you want to redirect back to. The domain (www.example.com) for this\n            // URL must be in the authorized domains list in the Firebase Console.\n            url: 'http://localhost:3000',\n            handleCodeInApp: true\n        };\n        sendSignInLinkToEmail(this.auth, email, actionCodeSettings).then(() => console.log(\"success\")).catch((err) => console.log(\"failed\", err));\n    }\n\n    isAnnoymousAccount() {\n        return isSignInWithEmailLink(this.auth, window.location.href)\n    }\n\n    // firestore\n\n    onPendingAccountsChange(callback: (pendings: Array<PendingApplcation>) => void) {\n        return onSnapshot(collection(this.firestore, COLLECTION.APPLICATION), collection => {\n            let pendings: Array<PendingApplcation> = [];\n            collection.forEach(application => pendings.push(Object.assign({ id: application.id }, application.data() as { name: string, email: string })));\n            callback(pendings)\n        })\n    }\n\n    async removePendingAccount(id: string) {\n        await deleteDoc(doc(this.firestore, COLLECTION.APPLICATION, id));\n    }\n\n    async checkNewAccount(email: string) {\n        return !(await getDoc(doc(this.firestore, COLLECTION.USER_PROFILE, email))).exists();\n    }\n\n    async updateUserProfile(profile: { email: string, name: string }) {\n        await setDoc(doc(this.firestore, COLLECTION.USER_PROFILE, profile.email), {\n            name: profile.name,\n            email: profile.email\n        })\n    }\n\n    async getCategories() {\n        let categories: Array<any> = [];\n        (await getDocs(collection(this.firestore, COLLECTION.CATEGORY).withConverter(categoryConverter))).forEach(cat => {\n            console.log(cat);\n            categories.push(cat);\n        });\n        return categories;\n    }\n\n    async getOptions(categoryId: string) {\n        let options: Array<Option> = [];\n        await getDocs(collection(this.firestore, COLLECTION.CATEGORY, categoryId, \"Options\").withConverter(optionConverter))\n            .then(opts => opts.forEach(\n                opt => options.push(opt.data())\n            ));\n        return options;\n    }\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}