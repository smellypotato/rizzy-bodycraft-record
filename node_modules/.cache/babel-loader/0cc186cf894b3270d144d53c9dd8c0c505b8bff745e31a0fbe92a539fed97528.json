{"ast":null,"code":"var _jsxFileName = \"/Users/HenryTsui/Desktop/rizzy-bodycraft-record/src/pages/Admin/Categories/Categories.tsx\",\n  _s = $RefreshSig$();\nimport { useCallback, useEffect, useState } from \"react\";\nimport { DropdownMenu } from \"../../../components/DropdownMenu/DropdownMenu\";\nimport { Title } from \"../../../components/Title/Title\";\nimport Firebase from \"../../../firebase\";\nimport \"./Categories.css\";\nimport { AddInputPanel } from \"../../../components/AddPanel/AddInputPanel\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nexport const Categories = () => {\n  _s();\n  var _categories$find;\n  const [categories, setCategories] = useState([]);\n  const [categoryId, setCategoryId] = useState();\n  const [activeDropdown, setActiveDropdown] = useState();\n  const [options, setOptions] = useState([]);\n  const [addModal, setAddModal] = useState();\n  useEffect(() => {\n    let closeDropdown = () => {\n      console.log(\"close dropdown\");\n      setActiveDropdown(undefined);\n    };\n    window.addEventListener(\"click\", closeDropdown);\n    return () => window.removeEventListener(\"click\", closeDropdown);\n  }, []);\n  useEffect(() => {\n    Firebase.instance.getCategories().then(categories => setCategories(categories.map(category => {\n      return {\n        label: category.title,\n        id: category.id\n      };\n    })));\n  }, []);\n\n  // useEffect(() => {\n  //     if (categoryId) Firebase.instance.getOptions(categoryId).then(options => setOptions(options));\n  // }, [categoryId]);\n\n  useEffect(() => {\n    if (categoryId) Firebase.instance.onOptionUpdate(categoryId, options => setOptions(options));\n  }, [categoryId]);\n  const onInput = useCallback((set, e) => {\n    set(e.currentTarget.value);\n  }, []);\n  const optionRow = useCallback(details => {\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"option\",\n      children: [/*#__PURE__*/_jsxDEV(\"button\", {\n        className: \"delete\",\n        onClick: () => Firebase.instance.deleteOption(categoryId, details.id)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 49,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n        value: details.title,\n        onChange: () => {}\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 50,\n        columnNumber: 17\n      }, this), details.choices ? /*#__PURE__*/_jsxDEV(DropdownMenu, {\n        onSelect: (_id, e) => e.stopPropagation(),\n        opened: activeDropdown === details.id,\n        onOpen: () => setActiveDropdown(details.id),\n        onClose: () => setActiveDropdown(undefined),\n        default: \"顯示所有選項\",\n        current: \"\",\n        choices: details.choices.map(choice => {\n          return {\n            id: details.id,\n            label: choice,\n            allowRemove: true\n          };\n        })\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 52,\n        columnNumber: 25\n      }, this) : /*#__PURE__*/_jsxDEV(\"div\", {\n        children: \"\\u8F38\\u5165\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 53,\n        columnNumber: 25\n      }, this)]\n    }, details.id, true, {\n      fileName: _jsxFileName,\n      lineNumber: 48,\n      columnNumber: 13\n    }, this);\n  }, [options, activeDropdown]);\n  const addOption = useCallback(label => {\n    Firebase.instance.addOption(categoryId, label);\n  }, [categoryId]);\n  return /*#__PURE__*/_jsxDEV(\"main\", {\n    id: \"categories\",\n    children: [/*#__PURE__*/_jsxDEV(Title, {}, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 65,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(\"section\", {\n      id: \"content\",\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        id: \"dropdown_big\",\n        children: /*#__PURE__*/_jsxDEV(DropdownMenu, {\n          onSelect: setCategoryId,\n          opened: activeDropdown === \"category\",\n          onOpen: () => setActiveDropdown(\"category\"),\n          onClose: () => setActiveDropdown(undefined),\n          default: \"選擇分類\",\n          current: (_categories$find = categories.find(cat => cat.id === categoryId)) === null || _categories$find === void 0 ? void 0 : _categories$find.label,\n          choices: categories\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 68,\n          columnNumber: 21\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 67,\n        columnNumber: 17\n      }, this), options.map(option => optionRow(option)), categoryId && /*#__PURE__*/_jsxDEV(\"button\", {\n        className: \"add\",\n        onClick: () => {},\n        children: \"\\u65B0\\u589E\\u9078\\u9805 \\uFF0B\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 71,\n        columnNumber: 33\n      }, this), categoryId && /*#__PURE__*/_jsxDEV(\"button\", {\n        className: \"add\",\n        onClick: () => setAddModal( /*#__PURE__*/_jsxDEV(AddInputPanel, {\n          categoryId: categoryId,\n          close: () => setAddModal(undefined)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 72,\n          columnNumber: 85\n        }, this)),\n        children: \"\\u65B0\\u589E\\u8F38\\u5165 \\uFF0B\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 72,\n        columnNumber: 33\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 66,\n      columnNumber: 13\n    }, this), addModal && addModal]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 64,\n    columnNumber: 9\n  }, this);\n};\n_s(Categories, \"IrfiG/w6M3iPrl2ALCOzMXQbc58=\");\n_c = Categories;\nvar _c;\n$RefreshReg$(_c, \"Categories\");","map":{"version":3,"names":["useCallback","useEffect","useState","DropdownMenu","Title","Firebase","AddInputPanel","Categories","categories","setCategories","categoryId","setCategoryId","activeDropdown","setActiveDropdown","options","setOptions","addModal","setAddModal","closeDropdown","console","log","undefined","window","addEventListener","removeEventListener","instance","getCategories","then","map","category","label","title","id","onOptionUpdate","onInput","set","e","currentTarget","value","optionRow","details","deleteOption","choices","_id","stopPropagation","choice","allowRemove","addOption","find","cat","option"],"sources":["/Users/HenryTsui/Desktop/rizzy-bodycraft-record/src/pages/Admin/Categories/Categories.tsx"],"sourcesContent":["import { useCallback, useEffect, useState } from \"react\";\nimport { DropdownMenu } from \"../../../components/DropdownMenu/DropdownMenu\";\nimport { Title } from \"../../../components/Title/Title\";\nimport Firebase from \"../../../firebase\";\nimport \"./Categories.css\";\nimport { Option } from \"../../../type\";\nimport { AddInputPanel } from \"../../../components/AddPanel/AddInputPanel\";\nexport const Categories = () => {\n\n    const [categories, setCategories] = useState<Array<{ label: string, id: string }>>([]);\n    const [categoryId, setCategoryId] = useState<string>();\n    const [activeDropdown, setActiveDropdown] = useState<string>();\n    const [options, setOptions] = useState<Array<Option>>([]);\n    const [addModal, setAddModal] = useState<JSX.Element>();\n\n    useEffect(() => {\n        let closeDropdown = () => {\n            console.log(\"close dropdown\");\n            setActiveDropdown(undefined)\n        };\n        window.addEventListener(\"click\", closeDropdown);\n\n        return () => window.removeEventListener(\"click\", closeDropdown);\n    }, [])\n\n    useEffect(() => {\n        Firebase.instance.getCategories().then(categories =>\n            setCategories(categories.map(category => {\n                return { label: category.title, id: category.id }\n            }))\n        );\n    }, [])\n\n    // useEffect(() => {\n    //     if (categoryId) Firebase.instance.getOptions(categoryId).then(options => setOptions(options));\n    // }, [categoryId]);\n\n    useEffect(() => {\n        if (categoryId) Firebase.instance.onOptionUpdate(categoryId, (options) => setOptions(options));\n    }, [categoryId])\n\n    const onInput = useCallback((set: React.Dispatch<string>, e: React.ChangeEvent<HTMLInputElement>) => {\n        set(e.currentTarget.value);\n    }, []);\n\n    const optionRow = useCallback((details: Option) => {\n        return (\n            <div className=\"option\" key={ details.id }>\n                <button className=\"delete\" onClick={ () => Firebase.instance.deleteOption(categoryId!, details.id)}/>\n                <input value={ details.title } onChange={ () => {} } />\n                {   details.choices ?\n                        <DropdownMenu onSelect={ (_id, e) => e.stopPropagation() } opened={ activeDropdown === details.id } onOpen={ () => setActiveDropdown(details.id) } onClose={ () => setActiveDropdown(undefined) } default={ \"顯示所有選項\" } current={ \"\" } choices={ details.choices.map(choice => { return { id: details.id, label: choice, allowRemove: true } }) } /> :\n                        <div>輸入</div>\n                }\n            </div>\n        )\n    }, [options, activeDropdown]);\n\n    const addOption = useCallback((label: string) => {\n        Firebase.instance.addOption(categoryId!, label);\n    }, [categoryId]);\n\n    return (\n        <main id=\"categories\">\n            <Title />\n            <section id=\"content\">\n                <div id=\"dropdown_big\">\n                    <DropdownMenu onSelect={ setCategoryId } opened={ activeDropdown === \"category\"} onOpen={ () => setActiveDropdown(\"category\") } onClose={ () => setActiveDropdown(undefined) } default={ \"選擇分類\" } current={ categories.find(cat => cat.id === categoryId)?.label } choices={ categories } />\n                </div>\n                { options.map(option => optionRow(option)) }\n                { categoryId && <button className=\"add\" onClick={ () => {} }>新增選項 ＋</button> }\n                { categoryId && <button className=\"add\" onClick={ () => setAddModal(<AddInputPanel categoryId={ categoryId } close={ () => setAddModal(undefined) } />) }>新增輸入 ＋</button> }\n            </section>\n            { addModal && addModal }\n        </main>\n    )\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}